<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InnexBot Icon Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #1B3B6F; }
    .icons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }
    .icon-item {
      text-align: center;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
    }
    canvas {
      border: none;
      border-radius: 0px;
      margin: 10px 0;
      background: white;
    }
    button {
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-top: 10px;
    }
    button:hover {
      opacity: 0.9;
    }
    .instructions {
      background: #fff7ed;
      border-left: 4px solid #FF6B35;
      padding: 15px;
      margin: 20px 0;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® InnexBot Icon Generator</h1>
    <p>Genera le icone circolari per l'estensione Chrome usando il logo InnexData.</p>
    
    <div class="instructions">
      <strong>Istruzioni:</strong>
      <ol>
        <li>Le icone verranno generate automaticamente al caricamento</li>
        <li>Clicca "Download" sotto ogni icona per salvarla</li>
        <li>Salva i file nella cartella <code>extension/icons/</code> con i nomi corretti</li>
      </ol>
    </div>

    <div id="loading" class="loading">
      ‚è≥ Caricamento logo in corso...
    </div>

    <div class="icons-grid" id="iconsGrid"></div>
  </div>

  <script>
    const sizes = [
      { size: 128, name: 'icon128.png' },
      { size: 48, name: 'icon48.png' },
      { size: 32, name: 'icon32.png' },
      { size: 16, name: 'icon16.png' }
    ];

    // Path del logo locale
    const LOGO_PATH = '../innexlogo.png';
    let logoImage = null;

    // Carica il logo
    function loadLogo() {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          logoImage = img;
          console.log('‚úì Logo caricato con successo');
          resolve(img);
        };
        img.onerror = (error) => {
          console.error('‚úó Errore caricamento logo:', error);
          reject(error);
        };
        img.src = LOGO_PATH;
      });
    }

    function generateIcon(size) {
      const canvas = document.createElement('canvas');
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext('2d');

      // Sfondo trasparente
      ctx.clearRect(0, 0, size, size);

      // Cerchio esterno con bordo grigio chiaro
      const borderWidth = size * 0.08; // Bordo 8% della dimensione
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
      ctx.fill();

      // Bordo grigio chiaro
      ctx.strokeStyle = '#E0E0E0';
      ctx.lineWidth = borderWidth;
      ctx.stroke();

      // Cerchio interno bianco (sfondo del logo)
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(size / 2, size / 2, (size / 2) - borderWidth, 0, Math.PI * 2);
      ctx.fill();

      // Disegna il logo al centro (se caricato)
      if (logoImage) {
        const logoSize = size * 0.7; // Logo occupa 70% del cerchio
        const logoX = (size - logoSize) / 2;
        const logoY = (size - logoSize) / 2;
        
        // Clip circolare per il logo
        ctx.save();
        ctx.beginPath();
        ctx.arc(size / 2, size / 2, (size / 2) - borderWidth, 0, Math.PI * 2);
        ctx.clip();
        
        ctx.drawImage(logoImage, logoX, logoY, logoSize, logoSize);
        ctx.restore();
      } else {
        // Fallback: testo "IB" se logo non disponibile
        ctx.fillStyle = '#1B3B6F';
        ctx.font = `bold ${size * 0.4}px Arial, sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('IB', size / 2, size / 2);
      }

      return canvas;
    }

    function downloadCanvas(canvas, filename) {
      try {
        canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.download = filename;
          link.href = url;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
          
          console.log(`‚úì Downloaded: ${filename}`);
        }, 'image/png');
      } catch (error) {
        console.error('Download error:', error);
        alert('Errore durante il download. Prova a fare click destro sull\'icona e "Salva immagine con nome"');
      }
    }

    async function generateAllIcons() {
      console.log('Generating icons...');
      const grid = document.getElementById('iconsGrid');
      const loading = document.getElementById('loading');
      grid.innerHTML = '';

      sizes.forEach(({ size, name }) => {
        const canvas = generateIcon(size);
        canvas.style.border = '1px solid #ddd';
        canvas.style.borderRadius = '50%'; // Icone circolari
        
        const item = document.createElement('div');
        item.className = 'icon-item';
        
        const title = document.createElement('h3');
        title.textContent = `${size}x${size}px`;
        title.style.marginBottom = '10px';
        title.style.color = '#1B3B6F';
        
        const canvasContainer = document.createElement('div');
        canvasContainer.appendChild(canvas);
        
        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = `üì• Download ${name}`;
        downloadBtn.onclick = function() {
          downloadIcon(name, size);
        };
        
        item.appendChild(title);
        item.appendChild(canvasContainer);
        item.appendChild(downloadBtn);
        
        grid.appendChild(item);
      });
      
      loading.style.display = 'none';
      console.log('‚úì Icons generated successfully!');
    }

    function downloadIcon(filename, size) {
      const canvas = generateIcon(size);
      downloadCanvas(canvas, filename);
    }

    // Auto-generate on load
    window.addEventListener('load', async function() {
      console.log('Page loaded, loading logo...');
      
      try {
        await loadLogo();
        console.log('Logo loaded, generating icons...');
        setTimeout(generateAllIcons, 300);
      } catch (error) {
        console.error('Error loading logo, generating with fallback:', error);
        document.getElementById('loading').innerHTML = '‚ö†Ô∏è Logo non disponibile, uso fallback "IB"';
        setTimeout(generateAllIcons, 500);
      }
    });
  </script>
</body>
</html>
